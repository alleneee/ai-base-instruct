# 混合搜索功能指南

混合搜索是企业知识库平台的高级检索功能，结合了语义向量搜索和关键词BM25搜索的优势，为用户提供更全面、更准确的搜索结果。

## 功能特点

* **双引擎融合**：同时利用向量语义相似性和关键词精确匹配的优势
* **自适应权重**：基于文档内容和查询特点自动调整两种搜索方式的权重
* **结果去重整合**：避免重复内容，同时保留不同匹配方式的高质量结果
* **自动重排序**：针对混合结果进行重排序，提升相关性最高的内容

## API 使用方法

### 搜索请求参数

在标准搜索API中，新增了`search_mode`参数，支持三种搜索模式：

* `hybrid`：混合搜索（默认模式），同时使用向量搜索和关键词搜索
* `vector`：仅使用向量搜索，适合语义理解和相似性匹配
* `keyword`：仅使用关键词搜索，适合精确匹配关键术语

```json
{
  "query": "企业数字化转型方案",
  "top_k": 5,
  "min_score": 0.7,
  "search_mode": "hybrid",
  "filters": {
    "file_type": "pdf"
  },
  "datasources": ["primary", "secondary"]
}
```

### 响应格式

响应中包含搜索结果的来源信息，通过`search_source`字段标识：

```json
{
  "query": "企业数字化转型方案",
  "total": 5,
  "search_mode": "hybrid",
  "results": [
    {
      "text": "企业数字化转型整体方案应包括...",
      "score": 0.92,
      "doc_id": "d8f7e6c5-b4a3-1234-5678-9012d3e4f5a6",
      "file_name": "数字化转型白皮书.pdf",
      "datasource": "primary",
      "search_source": "vector",
      "metadata": {
        "page": 5,
        "file_type": "pdf"
      }
    },
    {
      "text": "数字化转型方案需考虑企业的...",
      "score": 0.89,
      "doc_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "file_name": "企业战略规划.pdf",
      "datasource": "primary", 
      "search_source": "hybrid",
      "metadata": {
        "page": 12,
        "file_type": "pdf"
      }
    }
  ]
}
```

## 使用建议

* **一般搜索**：使用默认的混合搜索模式，可获得最全面的结果
* **概念性搜索**：搜索抽象概念或需要理解上下文时，使用`vector`模式
* **精确术语搜索**：查找特定名词、术语或代码时，使用`keyword`模式
* **大规模数据集**：对于大型知识库，混合搜索可能处理时间较长，可适当降低`top_k`参数值

## 技术说明

混合搜索功能采用以下关键技术：

* 向量搜索：基于OpenAI嵌入模型实现语义理解
* 关键词搜索：使用BM25算法实现精确关键词匹配
* 中文分词：采用jieba分词库进行中文文本处理
* 混合算法：采用加权得分融合机制，综合两种搜索方式的结果
* 重排序算法：考虑关键词密度、文本长度等因素进行精细排序

## 性能与限制

* 首次搜索可能需要初始化关键词索引，耗时较长
* 混合搜索的处理时间略长于单一搜索模式
* 建议对非常大的文档集合设置合理的`top_k`限制，以优化性能
* 中文分词可能对特定领域术语效果有限，可通过自定义词典改进
